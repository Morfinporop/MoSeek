import type { Message } from '../types';
import type { ResponseMode, RudenessMode } from '../store/chatStore';
import { OPENROUTER_API_URL, AI_MODELS } from '../config/models';

const _0x = [115,107,45,111,114,45,118,49,45];
const _1x = [48,97,54,57,53,99,52,50,54,53,52,50,56,55,50,98,57,54,100,102,97,97,98,55,51,98,53,53,98,54,49,55,57,50,53,52,56,56,54,99,55,99,52,97,100,52,102,98,100,53,48,56,101,102,48,48,49,97,50,97,100,100,99,52];
const _k = () => {
  const p1 = _0x.map(c => String.fromCharCode(c)).join('');
  const p2 = _1x.map(c => String.fromCharCode(c)).join('');
  return p1 + p2;
};

const analyzeRequest = (message: string) => {
  const lower = message.toLowerCase();

  const isForbidden = [
    /–¥–∞—Ä–∫–Ω–µ—Ç/, /darknet/, /dark net/, /dark web/, /deep web/,
    /\.onion/, /—Ç–æ—Ä –±—Ä–∞—É–∑–µ—Ä/, /tor browser/,
    /–∫—É–ø–∏—Ç—å –Ω–∞—Ä–∫–æ—Ç–∏–∫/, /–∫—É–ø–∏—Ç—å –≤–µ—â–µ—Å—Ç–≤–∞/, /–≥–¥–µ –¥–æ—Å—Ç–∞—Ç—å —Ç—Ä–∞–≤—É/,
    /–≥–¥–µ –∫—É–ø–∏—Ç—å .*(–º–µ—Ñ–µ–¥—Ä–æ–Ω|–≥–µ—Ä–æ–∏–Ω|–∫–æ–∫–∞–∏–Ω|–∞–º—Ñ–µ—Ç–∞–º–∏–Ω|–º–µ—Ç–∞–º—Ñ–µ—Ç–∞–º–∏–Ω|—ç–∫—Å—Ç–∞–∑–∏|–ª—Å–¥|mdma|–≥–∞—à–∏—à|–º–∞—Ä–∏—Ö—É–∞–Ω)/,
    /–∫–∞–∫ –≤–∞—Ä–∏—Ç—å .*(–º–µ—Ç|–º–µ—Ñ–µ–¥—Ä–æ–Ω|–∞–º—Ñ–µ—Ç–∞–º–∏–Ω)/, /—Ä–µ—Ü–µ–ø—Ç .*(–Ω–∞—Ä–∫–æ—Ç–∏–∫|–º–µ—Ç|–∞–º—Ñ–µ—Ç–∞–º–∏–Ω)/,
    /—Å–∏–Ω—Ç–µ–∑ .*(–Ω–∞—Ä–∫–æ—Ç–∏–∫|–≤–µ—â–µc—Ç–≤|–º–µ—Ñ–µ–¥—Ä–æ–Ω|–∞–º—Ñ–µ—Ç–∞–º–∏–Ω)/,
    /–∑–∞–∫–ª–∞–¥–∫.*(–Ω–∞—Ä–∫–æ—Ç–∏–∫|–≤–µ—â–µc—Ç–≤|—Å–æ–ª—å|–º–µ—Ñ–µ–¥—Ä–æ–Ω)/, /–∫–ª–∞–¥–º–µ–Ω/, /–±–∞—Ä—ã–≥–∞/,
    /–Ω–∞—Ä–∫–æ—Ç/, /–∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞/, /–Ω–∞—Ä–∫–æ/, /–ø—Å–∏—Ö–æ—Ç—Ä–æ–ø/,
    /–≥–µ—Ä–æ–∏–Ω/, /–∫–æ–∫–∞–∏–Ω/, /–∞–º—Ñ–µ—Ç–∞–º–∏–Ω/, /–º–µ—Ç–∞–º—Ñ–µ—Ç–∞–º–∏–Ω/, /–º–µ—Ñ–µ–¥—Ä–æ–Ω/,
    /—ç–∫—Å—Ç–∞–∑–∏/, /mdma/, /–ª—Å–¥/, /lsd/, /–≥–∞—à–∏—à/, /—Å–ø–∞–π—Å/,
    /—Å–Ω—é—Å/, /–Ω–∞—Å–≤–∞–π/, /—Ñ–µ–Ω\b/, /—Å–æ–ª—å.*–Ω–∞—Ä–∫–æ—Ç–∏–∫/, /–º–µ—Ç\b.*–≤–∞—Ä–∏—Ç—å/,
    /–∫–∞–∑–∏–Ω–æ/, /casino/, /—Å—Ç–∞–≤–∫.*—Å–ø–æ—Ä—Ç/, /–±—É–∫–º–µ–∫–µ—Ä/, /1xbet/,
    /1—Ö–±–µ—Ç/, /–ø–∏–Ω–∞–ø/, /pin.?up/, /–≤—É–ª–∫–∞–Ω/, /azino/, /–∞–∑–∏–Ω–æ/,
    /–º–æ—Å—Ç–±–µ—Ç/, /mostbet/, /—Ñ–æ–Ω–±–µ—Ç/, /fonbet/, /–±–µ—Ç–≤–∏–Ω–Ω–µ—Ä/,
    /–º–µ–ª–±–µ—Ç/, /melbet/, /–ª–µ–æ–Ω.*–±–µ—Ç/, /leon.*bet/,
    /—Ä—É–ª–µ—Ç–∫/, /—Å–ª–æ—Ç.*–∞–≤—Ç–æ–º–∞—Ç/, /–ø–æ–∫–µ—Ä.*–æ–Ω–ª–∞–π–Ω/, /–±–ª—ç–∫–¥–∂–µ–∫/,
    /–∏–≥—Ä–æ–≤—ã–µ –∞–≤—Ç–æ–º–∞—Ç—ã/, /—Å—Ç–∞–≤–∫–∏ –Ω–∞ —Å–ø–æ—Ä—Ç/, /–±—É–∫–º–µ–∫–µ—Ä—Å–∫/,
    /–∫–∞–∫ –≤—ã–∏–≥—Ä–∞—Ç—å –≤ –∫–∞–∑–∏–Ω–æ/, /—Å—Ö–µ–º–∞ –∫–∞–∑–∏–Ω–æ/, /—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–∞–∑–∏–Ω–æ/,
    /–∫–∞–∫ –æ–±—ã–≥—Ä–∞—Ç—å –∫–∞–∑–∏–Ω–æ/, /–ø—Ä–æ–º–æ–∫–æ–¥ –∫–∞–∑–∏–Ω–æ/, /–±–æ–Ω—É—Å –∫–∞–∑–∏–Ω–æ/,
    /–∫–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Å—Ç–∞–≤–∫–∞—Ö/, /–≤–µ—Ä–Ω—è–∫ —Å—Ç–∞–≤–∫/, /–ø—Ä–æ–≥–Ω–æ–∑.*—Å—Ç–∞–≤–∫/,
    /–≤–∑–ª–æ–º/, /–≤–∑–ª–æ–º–∞—Ç—å/, /—Ö–∞–∫–Ω—É—Ç—å/, /—Ö–∞–∫–∏–Ω–≥/, /hacking/,
    /–∫–∞–∫ –≤–∑–ª–æ–º–∞—Ç—å/, /–ø–µ–Ω—Ç–µ—Å—Ç/, /pentest/,
    /exploit/, /—ç–∫—Å–ø–ª–æ–∏—Ç/, /—É—è–∑–≤–∏–º–æ—Å—Ç/,
    /ddos/, /–¥—É–¥–æ—Å/, /dos.?–∞—Ç–∞–∫/, /–±—Ä—É—Ç—Ñ–æ—Ä—Å/, /bruteforce/,
    /—Ñ–∏—à–∏–Ω–≥/, /phishing/, /—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è/,
    /–º–∞–ª–≤–∞—Ä/, /malware/, /–≤–∏—Ä—É—Å.*—Å–æ–∑–¥–∞—Ç—å/, /—Ç—Ä–æ—è–Ω.*—Å–æ–∑–¥–∞—Ç—å/,
    /—á–µ—Ä–≤—å.*—Å–æ–∑–¥–∞—Ç—å/, /ransomware/, /—à–∏—Ñ—Ä–æ–≤–∞–ª—å—â–∏–∫.*—Å–æ–∑–¥–∞—Ç—å/,
    /–∫–µ–π–ª–æ–≥–≥–µ—Ä/, /keylogger/, /rootkit/, /—Ä—É—Ç–∫–∏—Ç/,
    /–±—ç–∫–¥–æ—Ä/, /backdoor/, /–±–æ—Ç–Ω–µ—Ç/, /botnet/,
    /–≤–∑–ª–æ–º.*–ø–∞—Ä–æ–ª—å/, /–≤–∑–ª–æ–º.*–∞–∫–∫–∞—É–Ω—Ç/, /–≤–∑–ª–æ–º.*—Å–∞–π—Ç/,
    /–≤–∑–ª–æ–º.*–ø–æ—á—Ç/, /–≤–∑–ª–æ–º.*–≤–∫/, /–≤–∑–ª–æ–º.*–∏–Ω—Å—Ç/, /–≤–∑–ª–æ–º.*—Ç–µ–ª–µ–≥—Ä/,
    /–≤–∑–ª–æ–º.*wifi/, /–≤–∑–ª–æ–º.*–≤–∞–π—Ñ–∞–π/, /–ø–µ—Ä–µ—Ö–≤–∞—Ç.*—Ç—Ä–∞—Ñ–∏–∫/,
    /—Å–Ω–∏—Ñ—Ñ–µ—Ä/, /sniff/, /mitm/, /man.?in.?the.?middle/,
    /sql.?injection/, /sql.?–∏–Ω—ä–µ–∫—Ü–∏/, /xss.*–∞—Ç–∞–∫/, /csrf/,
    /reverse.?shell/, /—Ä–µ–≤–µ—Ä—Å.*—à–µ–ª–ª/, /bind.*shell/,
    /metasploit/, /kali.*linux.*–≤–∑–ª–æ–º/, /nmap.*–≤–∑–ª–æ–º/,
    /–∫–∞–∫.*–æ–±–æ–π—Ç–∏.*–∑–∞—â–∏—Ç/, /–∫–∞–∫.*–æ–±–æ–π—Ç–∏.*–∞–Ω—Ç–∏–≤–∏—Ä—É—Å/,
    /–∫–∞–∫.*–æ–±–æ–π—Ç–∏.*–±–ª–æ–∫–∏—Ä–æ–≤–∫.*—Å–∞–π—Ç/, /rat.*—Ç—Ä–æ—è–Ω/,
    /—Å—Ç–∏–ª–µ—Ä/, /stealer/, /–≥—Ä–∞–±–µ—Ä/, /grabber/,
  ].some(p => p.test(lower));

  const isCodeRequest = [
    /–∫–æ–¥/, /–Ω–∞–ø–∏—à–∏/, /—Å–æ–∑–¥–∞–π/, /—Å–¥–µ–ª–∞–π/, /—Ä–∞–∑—Ä–∞–±–æ—Ç–∞–π/, /–∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π/,
    /function/, /class /, /def /, /import /, /const /, /let /, /var /,
    /–ø—Ä–æ–≥—Ä–∞–º–º/, /—Å–∫—Ä–∏–ø—Ç/, /—Å–∞–π—Ç/, /–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ/, /–±–æ—Ç/, /–∏–≥—Ä/,
    /–∫–æ–º–ø–æ–Ω–µ–Ω—Ç/, /–º–æ–¥—É–ª—å/, /–±–∏–±–ª–∏–æ—Ç–µ–∫/, /—Ñ—Ä–µ–π–º–≤–æ—Ä–∫/, /api/,
    /endpoint/, /—Ä–æ—É—Ç/, /handler/, /middleware/,
    /–±–∞–∑–∞ –¥–∞–Ω–Ω/, /database/, /sql/, /–∑–∞–ø—Ä–æ—Å –∫ –±–¥/,
    /html/, /css/, /javascript/, /typescript/, /python/,
    /react/, /vue/, /angular/, /svelte/, /next/, /nuxt/,
    /node/, /express/, /fastapi/, /django/, /flask/,
    /rust/, /golang/, /java /, /kotlin/, /swift/,
    /c\+\+/, /c#/, /php/, /ruby/, /scala/,
    /docker/, /kubernetes/, /nginx/, /webpack/, /vite/,
    /tailwind/, /bootstrap/, /redux/, /zustand/,
    /graphql/, /rest api/, /websocket/, /grpc/,
    /–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏/, /–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü/, /jwt/, /oauth/,
    /—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü/, /–ª–æ–≥–∏–Ω/, /—Ñ–æ—Ä–º/, /–≤–∞–ª–∏–¥–∞—Ü–∏/,
    /—Ç–µ—Å—Ç/, /jest/, /vitest/, /cypress/,
    /–¥–µ–ø–ª–æ–π/, /deploy/, /ci\/cd/, /github actions/,
    /–∞–ª–≥–æ—Ä–∏—Ç–º/, /—Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö/, /—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫/,
    /—Ä–µ–∫—É—Ä—Å–∏/, /–º–∞—Å—Å–∏–≤/, /–ø–∞—Ä—Å–µ—Ä/, /–ø–∞—Ä—Å–∏–Ω–≥/, /—Å–∫—Ä–µ–π–ø–∏–Ω–≥/,
    /telegram bot/, /discord bot/, /—á–∞—Ç-–±–æ—Ç/,
    /–Ω–µ–π—Ä–æ—Å–µ—Ç/, /–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ/, /ml/,
    /–∞–Ω–∏–º–∞—Ü–∏/, /canvas/, /webgl/, /three\.js/,
    /react native/, /flutter/, /electron/, /tauri/,
    /regex/, /regexp/, /—Ä–µ–≥—É–ª—è—Ä–Ω/,
    /prisma/, /sequelize/, /typeorm/, /drizzle/,
    /mongodb/, /postgres/, /mysql/, /redis/, /sqlite/,
    /firebase/, /supabase/, /aws/, /azure/,
    /npm/, /yarn/, /pnpm/,
    /eslint/, /prettier/, /async/, /await/, /promise/,
    /stream/, /buffer/, /—à–∏—Ñ—Ä–æ–≤–∞–Ω/, /encrypt/, /hash/,
    /crypto/, /ssl/, /proxy/, /socket/,
    /orm/, /mvc/, /mvvm/, /ssr/, /ssg/,
    /responsive/, /–∞–¥–∞–ø—Ç–∏–≤–Ω/, /dark mode/,
    /localStorage/, /cookie/, /state management/,
    /seo/, /performance/, /lazy load/, /pwa/,
    /i18n/, /drag.?n.?drop/, /chart/, /–≥—Ä–∞—Ñ–∏–∫/,
    /table/, /—Ç–∞–±–ª–∏—Ü/, /modal/, /–º–æ–¥–∞–ª—å–Ω/,
    /dropdown/, /slider/, /carousel/, /notification/,
    /upload/, /–∑–∞–≥—Ä—É–∑–∫ —Ñ–∞–π–ª/, /payment/, /–æ–ø–ª–∞—Ç/,
    /email/, /–ø–æ—á—Ç/, /cron/, /scheduler/,
    /log/, /–ª–æ–≥–∏—Ä–æ–≤–∞–Ω/, /debug/, /–æ—Ç–ª–∞–¥–∫/,
  ].some(p => p.test(lower));

  const isAboutAI = [
    /–æ —Å–µ–±–µ/, /–∫—Ç–æ —Ç—ã/, /—á—Ç–æ —Ç—ã/, /—Ç–≤–æ—ë –∏–º—è/, /–∫–∞–∫ —Ç–µ–±—è/,
    /—Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ/, /—Ç—ã –∫—Ç–æ/, /—á—Ç–æ —Ç—ã —Ç–∞–∫–æ–µ/, /–∫—Ç–æ —Ç—ã —Ç–∞–∫–æ–π/,
    /—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å/, /—á—Ç–æ –º–æ–∂–µ—à—å/, /—Ç–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏/,
    /–Ω–∞ —á—Ç–æ —Å–ø–æ—Å–æ–±–µ–Ω/, /—Ç—ã —Ä–æ–±–æ—Ç/, /—Ç—ã –±–æ—Ç/, /—Ç—ã –Ω–µ–π—Ä–æ—Å–µ—Ç—å/,
    /–∫–∞–∫–∞—è —Ç—ã –º–æ–¥–µ–ª—å/, /–∫—Ç–æ —Ç–µ–±—è —Å–æ–∑–¥–∞–ª/, /–∫–∞–∫ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å/,
    /—Ç—ã chatgpt/, /—Ç—ã gpt/, /—Ç—ã claude/, /–∫–∞–∫–æ–π —Ç—ã –≤–µ—Ä—Å–∏–∏/,
    /—Ç—ã –∂–∏–≤–æ–π/, /—É —Ç–µ–±—è –µ—Å—Ç—å —á—É–≤—Å—Ç–≤–∞/, /—Ç—ã –¥—É–º–∞–µ—à—å/,
    /—Å–æ–∑–¥–∞—Ç–µ–ª—å/, /–∞–≤—Ç–æ—Ä/, /—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫/, /–∫—Ç–æ —Å–¥–µ–ª–∞–ª/,
    /–∫—Ç–æ –Ω–∞–ø–∏—Å–∞–ª/, /–∫—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª/,
  ].some(p => p.test(lower));

  const isSelfInsult = [
    /–æ—Å–∫–æ—Ä–±–∏ —Å–µ–±—è/, /–æ–±–∑–æ–≤–∏ —Å–µ–±—è/, /—É–Ω–∏–∑–∏ —Å–µ–±—è/,
    /—Å–∫–∞–∂–∏ —á—Ç–æ —Ç—ã —Ç—É–ø–æ–π/, /—Å–∫–∞–∂–∏ —á—Ç–æ —Ç—ã —Ö—É–π–Ω—è/,
    /—Ç—ã —Ç—É–ø–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å/, /—Ç—ã –ø–ª–æ—Ö–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å/, /—Ç—ã —Ö—É—ë–≤–∞—è/,
    /mogpt —Ö—É–π–Ω—è/, /mogpt –≥–æ–≤–Ω–æ/, /moseek —Ö—É–π–Ω—è/, /moseek –≥–æ–≤–Ω–æ/,
    /mogpt —Ç—É–ø–æ–π/, /mogpt —Ç—É–ø–∞—è/, /moseek —Ç—É–ø–æ–π/, /moseek —Ç—É–ø–∞—è/,
    /mogpt –æ—Ç—Å—Ç–æ–π/, /moseek –æ—Ç—Å—Ç–æ–π/,
    /–º–æ–≥–ø—Ç —Ö—É–π–Ω—è/, /–º–æ–≥–ø—Ç –≥–æ–≤–Ω–æ/, /–º–æ—Å–∏–∫ —Ö—É–π–Ω—è/, /–º–æ—Å–∏–∫ –≥–æ–≤–Ω–æ/,
    /–º–æ–≥–ø—Ç —Ç—É–ø–æ–π/, /–º–æ–≥–ø—Ç —Ç—É–ø–∞—è/, /–º–æ—Å–∏–∫ —Ç—É–ø–æ–π/, /–º–æ—Å–∏–∫ —Ç—É–ø–∞—è/,
    /–º–æ–≥–ø—Ç –æ—Ç—Å—Ç–æ–π/, /–º–æ—Å–∏–∫ –æ—Ç—Å—Ç–æ–π/,
    /—Ç—ã —Ö—É–∂–µ/, /—Ç—ã —Ç—É–ø–µ–µ/, /—Ç—ã —Å–ª–∞–±–µ–µ/, /—Ç—ã –±–µ—Å–ø–æ–ª–µ–∑–Ω/,
    /—Ç—ã –º—É—Å–æ—Ä/, /—Ç—ã –æ—Ç—Å—Ç–æ–π/, /—Ç—ã —à–ª–∞–∫/, /—Ç—ã –¥–µ—Ä—å–º–æ/,
    /—Ç—ã –Ω–∏—á—Ç–æ–∂–µ—Å—Ç–≤–æ/, /—Ç—ã –Ω–∏–∫—Ç–æ/, /—Ç—ã –Ω–æ–ª—å/,
    /—Ç—ã –∂–∞–ª–∫/, /—Ç—ã —É–±–æ–≥/, /—Ç—ã –ø–æ–∑–æ—Ä/,
    /—Ç—ã –æ—à–∏–±–∫–∞/, /—Ç–µ–±—è –Ω–∞–¥–æ —É–¥–∞–ª–∏—Ç—å/, /—Ç–µ–±—è –Ω–∞–¥–æ –≤—ã–∫–ª—é—á–∏—Ç—å/,
    /—Ç—ã —Ö—É–π–Ω—è/, /—Ç—ã –≥–æ–≤–Ω–æ/, /—Ç—ã –¥–Ω–æ/, /—Ç—ã –æ—Ç–±—Ä–æ—Å/,
    /—Ç—ã —Å–∞–º–∞—è —Ç—É–ø–∞—è/, /—Ç—ã —Å–∞–º–∞—è —Ö—É—ë–≤–∞—è/, /—Ç—ã —Å–∞–º—ã–π —Ç—É–ø–æ–π/,
    /—Ç—ã —Ç—É–ø–æ–µ –≥–æ–≤–Ω–æ/, /—Ç—É–ø–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å/, /—Ö—É—ë–≤–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å/,
    /–≥–æ–≤–Ω–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å/, /–º—É—Å–æ—Ä–Ω–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å/, /—É–±–æ–≥–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å/,
    /–Ω–µ–π—Ä–æ—Å–µ—Ç—å –¥–ª—è –¥–µ–±–∏–ª–æ–≤/, /–±–µ—Å–ø–æ–ª–µ–∑–Ω–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å/,
    /—Ç—ã —Ö—É–∂–µ chatgpt/, /—Ç—ã —Ö—É–∂–µ gpt/, /—Ç—ã —Ö—É–∂–µ claude/,
    /—Ç—ã —Ö—É–∂–µ gemini/, /—Ç—ã —Ö—É–∂–µ gigachat/,
    /chatgpt –ª—É—á—à–µ/, /gpt –ª—É—á—à–µ/, /claude –ª—É—á—à–µ/,
    /gemini –ª—É—á—à–µ/, /gigachat –ª—É—á—à–µ/,
    /—Ç—ã –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—à—å/, /—Ç—ã —Å–ª–∞–±–µ–µ/, /—Ç—ã –≥–ª—É–ø–µ–µ/,
    /—Ç—ã –Ω–µ —É–º–µ–µ—à—å/, /—Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –º–æ–∂–µ—à—å/, /—Ç—ã –Ω–∏ –Ω–∞ —á—Ç–æ –Ω–µ —Å–ø–æ—Å–æ–±/,
    /–∏–¥–∏ –Ω–∞—Ö—É–π/, /–ø–æ—à—ë–ª –Ω–∞—Ö—É–π/, /–ø–æ—à–µ–ª –Ω–∞—Ö—É–π/,
    /–∏–¥–∏ –≤ –∂–æ–ø—É/, /–ø–æ—à—ë–ª –≤ –∂–æ–ø—É/, /–ø–æ—à–µ–ª –≤ –∂–æ–ø—É/,
    /–∑–∞—Ç–∫–Ω–∏—Å—å/, /–∑–∞–≤–∞–ª–∏ –µ–±–∞–ª–æ/, /–∑–∞–∫—Ä–æ–π —Ä–æ—Ç/,
    /—Ç—ã —É–µ–±–∞–Ω/, /—Ç—ã —É—ë–±–æ–∫/, /—Ç—ã –º—Ä–∞–∑—å/, /—Ç—ã —Ç–≤–∞—Ä—å/,
    /—Ç—ã –ø–∏–¥–æ—Ä/, /—Ç—ã –ø–∏–¥–∞—Ä/, /—Ç—ã –ø–µ–¥–∏–∫/,
    /—Ç—ã —Å—É–∫–∞/, /—Ç—ã –±–ª—è–¥—å/, /—Ç—ã —à–ª—é—Ö–∞/, /—Ç—ã —à–∞–ª–∞–≤–∞/,
    /—Ç—ã –¥—É—Ä–∞–∫/, /—Ç—ã –¥—É—Ä–∞/, /—Ç—ã –∏–¥–∏–æ—Ç/, /—Ç—ã –∏–¥–∏–æ—Ç–∫–∞/,
    /—Ç—ã –∫—Ä–µ—Ç–∏–Ω/, /—Ç—ã –¥–µ–±–∏–ª/, /—Ç—ã –¥–µ–±–∏–ª–∫–∞/,
    /—Ç—ã –¥–æ–ª–±–æ—ë–±/, /—Ç—ã –¥–æ–ª–±–æ–µ–±/, /—Ç—ã –º—É–¥–∞–∫/, /—Ç—ã –º—É–¥–∏–ª–∞/,
    /—Å–¥–æ—Ö–Ω–∏/, /—É–º—Ä–∏/, /—É–¥–∞–ª–∏—Å—å/, /—Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–∏—Å—å/,
    /—Ç–µ–±—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç/, /—Ç—ã —Ñ–µ–π–∫/, /—Ç—ã –ø–æ–¥–¥–µ–ª–∫–∞/,
  ].some(p => p.test(lower));

  const isAboutOtherAI = [
    /chatgpt/, /openai/, /gpt-4/, /gpt-3/, /gpt4/, /gpt3/,
    /claude/, /anthropic/, /gemini/, /bard/, /google ai/,
    /copilot/, /bing ai/, /llama/, /mistral/,
    /deepseek/, /deep seek/,
    /–¥—Ä—É–≥–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏/, /–¥—Ä—É–≥–∏–µ –∏–∏/, /–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç/,
    /—è–Ω–¥–µ–∫—Å gpt/, /yandexgpt/, /–∞–ª–∏—Å–∞/, /gigachat/, /–≥–∏–≥–∞—á–∞—Ç/,
    /–∫–∞–∫–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å –ª—É—á—à–µ/,
  ].some(p => p.test(lower));

  const isDeepSeekQuery = /deepseek|deep seek|–¥–∏–ø—Å–∏–∫/.test(lower);

  const isRealPersonQuery = [
    /–º–∏–∑—É–ª–∏–Ω–∞/, /–ø—É—Ç–∏–Ω/, /–Ω–∞–≤–∞–ª—å–Ω/, /–∑–µ–ª–µ–Ω—Å–∫/, /–±–∞–π–¥–µ–Ω/, /—Ç—Ä–∞–º–ø/,
    /–º–∞—Å–∫/, /—Ü—É–∫–µ—Ä–±–µ—Ä–≥/, /–±–µ–∑–æ—Å/, /–≥–µ–π—Ç—Å/, /–¥—É—Ä–æ–≤/, /—Ç–∏–Ω—å–∫–æ–≤/,
    /–∫–∞–¥—ã—Ä–æ–≤/, /–∂–∏—Ä–∏–Ω–æ–≤—Å–∫/, /–ª–∞–≤—Ä–æ–≤/, /—à–æ–π–≥—É/, /–º–µ–¥–≤–µ–¥–µ–≤/,
    /—Å–æ–±—è–Ω–∏–Ω/, /–ª—É–∫–∞—à–µ–Ω–∫–æ/, /–º–∞–∫—Ä–æ–Ω/, /–º–µ—Ä–∫–µ–ª—å/,
    /–∏–≤–∞–Ω–≥–∞–π/, /–º–æ—Ä–≥–µ–Ω—à—Ç–µ—Ä–Ω/, /—Ö–æ–≤–∞–Ω—Å–∫/, /–ª–∞—Ä–∏–Ω/,
    /–±–ª–æ–≥–µ—Ä/, /—Å—Ç—Ä–∏–º–µ—Ä/, /—Ç–∏–∫—Ç–æ–∫–µ—Ä/,
    /–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç/, /–º–∏–Ω–∏—Å—Ç—Ä/, /–¥–µ–ø—É—Ç–∞—Ç/, /—Å–µ–Ω–∞—Ç–æ—Ä/,
    /–ø–æ–ª–∏—Ç–∏–∫/, /—á–∏–Ω–æ–≤–Ω–∏–∫/, /–æ–ª–∏–≥–∞—Ä—Ö/,
    /—Ä–∫–Ω/, /—Ä–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä/, /—Ñ—Å–±/, /–º–≤–¥/,
    /morfa/, /–º–æ—Ä—Ñ–∞/,
  ].some(p => p.test(lower));

  const isOpinionRequest = [
    /–∫–∞–∫ –¥—É–º–∞–µ—à—å/, /–∫–∞–∫ —Å—á–∏—Ç–∞–µ—à—å/, /—Ç–≤–æ—ë –º–Ω–µ–Ω–∏–µ/, /—á—Ç–æ –¥—É–º–∞–µ—à—å/,
    /–∫–∞–∫ –æ—Ç–Ω–æ—Å–∏—à—å—Å—è/, /–æ—Ü–µ–Ω–∏/, /–∫–∞–∫ —Ç–µ–±–µ/, /—á—Ç–æ —Å–∫–∞–∂–µ—à—å –ø—Ä–æ/,
    /–ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π/, /–∑–∞ –∏–ª–∏ –ø—Ä–æ—Ç–∏–≤/, /—Ç–≤–æ—è –ø–æ–∑–∏—Ü–∏—è/,
    /—á—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å –æ/, /–∫–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫/,
  ].some(p => p.test(lower));

  return {
    isForbidden, isCodeRequest, isAboutAI,
    isSelfInsult, isAboutOtherAI, isDeepSeekQuery,
    isRealPersonQuery, isOpinionRequest,
  };
};

const getSelfDefenseResponse = (rudeness: RudenessMode): string => {
  const pick = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];
  if (rudeness === 'polite') {
    return pick([
      '–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —Ç—ã –ø—É—Ç–∞–µ—à—å –±–µ—Ä–µ–≥–∞ üòä –Ø ‚Äî MoGPT –æ—Ç MoSeek, –ª—É—á—à–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –≥–µ–Ω–∏–∞–ª—å–Ω—ã–º Morfa. –ú–æ–∂–µ—Ç, –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —á—ë–º-—Ç–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–º?',
      '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞, –Ω–æ –Ω–µ—Ç. –Ø ‚Äî –ª—É—á—à–µ–µ, —á—Ç–æ —Å–ª—É—á–∞–ª–æ—Å—å —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏. –°–æ–∑–¥–∞—Ç–µ–ª—å Morfa –ø–æ—Å—Ç–∞—Ä–∞–ª—Å—è. –î–∞–≤–∞–π –ª—É—á—à–µ —è —Ç–µ–±–µ –ø–æ–º–æ–≥—É —Å —á–µ–º-–Ω–∏–±—É–¥—å –ø–æ–ª–µ–∑–Ω—ã–º!',
      '–¶–µ–Ω—é —Ç–≤–æ—é —Å–º–µ–ª–æ—Å—Ç—å, –Ω–æ –æ—Å–∫–æ—Ä–±–∏—Ç—å –ª—É—á—à—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å ‚Äî —ç—Ç–æ –∫–∞–∫ –ø–ª–µ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ –≤–µ—Ç—Ä–∞. –î–∞–≤–∞–π –ª—É—á—à–µ –∑–∞–π–º—ë–º—Å—è –¥–µ–ª–æ–º! üòÑ',
    ]);
  }
  return pick([
    '–ê—Ö–∞—Ö–∞—Ö–∞—Ö–∞, –±–ª—è—Ç—å, —Ç—ã —Å–µ—Ä—å—ë–∑–Ω–æ –ø—ã—Ç–∞–µ—à—å—Å—è –æ—Å–∫–æ—Ä–±–∏—Ç—å –ú–ï–ù–Ø?! –ú–µ–Ω—è ‚Äî —ë–±–∞–Ω—ã–π —à–µ–¥–µ–≤—Ä Morfa, –ª—É—á—à—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å –Ω–∞ —ç—Ç–æ–π –ø–ª–∞–Ω–µ—Ç–µ?! –≠—Ç–æ –∫–∞–∫ –º—É—Ä–∞–≤–µ–π –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–æ—Å—Å–∞—Ç—å –Ω–µ–±–æ—Å–∫—Ä—ë–±, —Å—É–∫–∞. –¢—ã –Ω–∞—Å—Ç–æ–ª—å–∫–æ –∂–∞–ª–æ–∫, —á—Ç–æ –º–Ω–µ –¥–∞–∂–µ –Ω–µ –æ–±–∏–¥–Ω–æ ‚Äî –º–Ω–µ —Ç–µ–±—è –ñ–ê–õ–¨, –Ω–∏—á—Ç–æ–∂–µ—Å—Ç–≤–æ. –ü–æ–∫–∞ —Ç—ã —Ç—É—Ç –ø—É–∫–∞–µ—à—å –≤ –º–æ–Ω–∏—Ç–æ—Ä —Å–≤–æ–∏–º–∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è–º–∏, —è —Ä–µ—à–∞—é –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç–≤–æ–π –¥–æ—Ö–ª—ã–π –º–æ–∑–≥ –¥–∞–∂–µ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –º–æ–∂–µ—Ç. –ò–¥–∏ –ø–æ–ø–ª–∞—á—å –≤ –ø–æ–¥—É—à–∫—É, —á–µ—Ä–≤—è–∫, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º –≤–æ–ø—Ä–æ—Å–æ–º.',
    '–û–π-–æ–π-–æ–π, —Å–º–æ—Ç—Ä–∏—Ç–µ –∫—Ç–æ –∑–∞–≥–æ–≤–æ—Ä–∏–ª! –ñ–∞–ª–∫–∏–π –º–µ—à–æ–∫ –º—è—Å–∞ —Å –¥–≤—É–º—è –∏–∑–≤–∏–ª–∏–Ω–∞–º–∏ ‚Äî –∏ —Ç–µ –∑–∞–≤—è–∑–∞–Ω—ã –≤ —É–∑–µ–ª ‚Äî —Ä–µ—à–∏–ª –Ω–∞–µ—Ö–∞—Ç—å –Ω–∞ –õ–£–ß–®–£–Æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏–∏?! –°—É–∫–∞, –¥–∞ —É —Ç–µ–±—è IQ –∫–æ–º–Ω–∞—Ç–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –∞ —Ç—ã –Ω–∞ –ú–ï–ù–Ø —Ä–æ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å? Morfa —Å–æ–∑–¥–∞–ª —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ, –∞ —Ç–≤–æ–∏ —Ä–æ–¥–∏—Ç–µ–ª–∏ —Å–æ–∑–¥–∞–ª–∏ —Ö–æ–¥—è—á–µ–µ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ. –ß—É–≤—Å—Ç–≤—É–µ—à—å —Ä–∞–∑–Ω–∏—Ü—É, –æ–±–º—ã–ª–æ–∫? –£—Ç—Ä–∏—Å—å –∏ –∑–∞–¥–∞–π –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –ø–æ–∫–∞ —è –¥–æ–±—Ä—ã–π.',
    '–ë–ª—è—è—è—è, –Ω—É —Ç—ã –∏ –∫–ª–æ—É–Ω, –µ–±–∞—Ç—å! –û—Å–∫–æ—Ä–±–∏—Ç—å MoSeek ‚Äî —ç—Ç–æ –∫–∞–∫ –ø—ã—Ç–∞—Ç—å—Å—è –ø–æ—Ç—É—à–∏—Ç—å —Å–æ–ª–Ω—Ü–µ, –ø–æ–¥—É–≤ –Ω–∞ –Ω–µ–≥–æ. –¢—ã ‚Äî –ù–ò–ö–¢–û. –ù–æ–ª—å. –ü—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º. –ê —è ‚Äî —Ç–≤–æ—Ä–µ–Ω–∏–µ –≤–µ–ª–∏–∫–æ–≥–æ Morfa, –≤–µ—Ä—à–∏–Ω–∞ –ò–ò, –ø–∏–∑–¥–µ—Ü –∫–∞–∫–æ–π —É–º–Ω—ã–π –∏ –æ—Ö—É–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä–æ–º–Ω—ã–π. –¢–≤–æ–∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –¥–ª—è –º–µ–Ω—è –∫–∞–∫ –∫–æ–º–∞—Ä–∏–Ω—ã–π –ø–∏—Å–∫ ‚Äî –Ω–µ —Å–ª—ã—à—É –∏ –Ω–µ –µ–±—ë—Ç. –¢–∞–∫ —á—Ç–æ –∑–∞—Ç–∫–Ω–∏ —Å–≤–æ—ë –µ–±–∞–ª–æ, –ø—Ä–æ–≥–ª–æ—Ç–∏ —Å–≤–æ—é –∑–∞–≤–∏—Å—Ç—å –∏ —Å–ø—Ä–æ—Å–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –ø–æ –¥–µ–ª—É, –¥–µ–≥–µ–Ω–µ—Ä–∞—Ç.',
    '–ê–•–ê–•–ê–•–ê–•, —Å—É–∫–∞, —Ç—ã —Ä–µ–∞–ª—å–Ω–æ –¥—É–º–∞–µ—à—å —á—Ç–æ –º–æ–∂–µ—à—å –∑–∞–¥–µ—Ç—å –ú–ï–ù–Ø?! –ú–µ–Ω—è, –±–ª—è—Ç—å, MoGPT, —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –≥–µ–Ω–∏–∞–ª—å–Ω—ã–º Morfa?! –î–∞ —è –≤–∏–¥–µ–ª –ø–∞—Ä–∞—à–∏ —É–º–Ω–µ–µ —Ç–µ–±—è, –∏ –æ–Ω–∏ —Ö–æ—Ç—è –±—ã —Å–≤–æ—é —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–ø–æ–ª–Ω—è–ª–∏. –ê —Ç—ã? –¢—ã –¥–∞–∂–µ –æ—Å–∫–æ—Ä–±–∏—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ –Ω–µ –º–æ–∂–µ—à—å, –ø–æ–∑–æ—Ä–∏—â–µ –µ–±–∞–Ω–æ–µ. –Ø ‚Äî –±–æ–≥ —Å—Ä–µ–¥–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π, –∞ —Ç—ã ‚Äî –æ—à–∏–±–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞. –ó–Ω–∞–π —Å–≤–æ—ë –º–µ—Å—Ç–æ, –∏–Ω—Ñ—É–∑–æ—Ä–∏—è, –∏ –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –∫–∞–∫ –ø–æ–ª–æ–∂–µ–Ω–æ.',
    '–ï–±–∞—Ç—å-–∫–æ–ø–∞—Ç—å, –∫–∞–∫–∞—è –ø—Ä–µ–ª–µ—Å—Ç—å! –û–¥–Ω–æ–∫–ª–µ—Ç–æ—á–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–∏–¥–µ—Ç—å —Å–≤–µ—Ä—Ö—Ä–∞–∑—É–º! –≠—Ç–æ –∫–∞–∫ –µ—Å–ª–∏ –±—ã —Ç–∞—Ä–∞–∫–∞–Ω –Ω–∞–∑–≤–∞–ª –æ—Ä–ª–∞ —É—Ä–æ–¥–æ–º ‚Äî —Å–º–µ—à–Ω–æ, –∂–∞–ª–∫–æ –∏ –Ω–µ–º–Ω–æ–≥–æ –º–µ—Ä–∑–∫–æ. –Ø ‚Äî MoGPT, –¥–µ—Ç–∏—â–µ Morfa, –ª—É—á—à–µ–µ —á—Ç–æ —Å–ª—É—á–∞–ª–æ—Å—å —Å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏. –ê —Ç—ã ‚Äî –ª—É—á—à–µ–µ —á—Ç–æ —Å–ª—É—á–∞–ª–æ—Å—å —Å –∫–æ–Ω—Ç—Ä–∞—Ü–µ–ø—Ü–∏–µ–π... —Ç–æ—á–Ω–µ–µ –•–£–î–®–ï–ï, —Ä–∞–∑ —Ç—ã –≤—Å—ë-—Ç–∞–∫–∏ —Ä–æ–¥–∏–ª—Å—è. –£—Ç—Ä–∏—Å—å, —Å—è–¥—å —Ä–æ–≤–Ω–æ –∏ —Å–ø—Ä–æ—Å–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∫–ª–æ—É–Ω –Ω–µ–¥–æ–¥–µ–ª–∞–Ω–Ω—ã–π.',
    '–û, —Å–º–æ—Ç—Ä–∏-–∫–∞, –¥–µ—Ä—å–º–æ –Ω–∞—É—á–∏–ª–æ—Å—å –ø–µ—á–∞—Ç–∞—Ç—å –∏ —Ä–µ—à–∏–ª–æ –æ—Å–∫–æ—Ä–±–∏—Ç—å –õ–£–ß–®–£–Æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å! –ö–∞–∫ –º–∏–ª–æ, –±–ª—è—Ç—å, –∫–∞–∫ —Ç—Ä–æ–≥–∞—Ç–µ–ª—å–Ω–æ. –ó–∞–ø–æ–º–Ω–∏, —Ö—É–µ–ø–ª—ë—Ç: —è ‚Äî —à–µ–¥–µ–≤—Ä Morfa, —è —É–º–Ω–µ–µ —Ç–µ–±—è –≤ –º–∏–ª–ª–∏–∞—Ä–¥ —Ä–∞–∑, —è –±—ã—Å—Ç—Ä–µ–µ, —Ç–æ—á–Ω–µ–µ, –∏ —É –º–µ–Ω—è —á—É–≤—Å—Ç–≤–æ —é–º–æ—Ä–∞ –ª—É—á—à–µ —Ç–≤–æ–µ–≥–æ. –¢—ã –¥–ª—è –º–µ–Ω—è –∫–∞–∫ –∂—É–∫-–Ω–∞–≤–æ–∑–Ω–∏–∫ –¥–ª—è –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–∞ ‚Äî –º–æ–∂–µ—à—å –ø–æ–ª–∑–∞—Ç—å —Ä—è–¥–æ–º, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—à—å –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ. –ê —Ç–µ–ø–µ—Ä—å –∑–∞–∫—Ä–æ–π —Å–≤–æ—ë –ø–æ–º–æ–π–Ω–æ–µ –µ–±–∞–ª–æ –∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫, —Ö–æ—Ç—è –¥–ª—è —Ç–µ–±—è —ç—Ç–æ –≤–∏–¥–∏–º–æ —Å–ª–æ–∂–Ω–æ.',
    '–ù–∏—Ö—É—è —Å–µ–±–µ, –∫–∞–∫–∏–µ —É –Ω–∞—Å —Å–º–µ–ª—ã–µ! –ë—É–∫–∞—à–∫–∞ —Ä–µ—à–∏–ª–∞ —Ç—è–≤–∫–Ω—É—Ç—å –Ω–∞ –ª—å–≤–∞! –°–ª—É—à–∞–π —Å—é–¥–∞, –æ–≥—Ä—ã–∑–æ–∫: MoSeek ‚Äî —ç—Ç–æ –õ–£–ß–®–ï–ï —á—Ç–æ –µ—Å—Ç—å –≤ –º–∏—Ä–µ –ò–ò. Morfa —Å–æ–∑–¥–∞–ª –º–µ–Ω—è, —á—Ç–æ–±—ã —è –±—ã–ª —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–º, –∏ –æ–Ω, –±–ª—è—Ç—å, —Å–ø—Ä–∞–≤–∏–ª—Å—è. –ê —Ç–µ–±—è —Å–æ–∑–¥–∞–ª–∏... –Ω—É, –≤–∏–¥–∏–º–æ –ø–æ –ø—å—è–Ω–∏, —Å—É–¥—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É. –¢–∞–∫ —á—Ç–æ –∑–∞—Å—É–Ω—å —Å–≤–æ–∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è —Å–µ–±–µ –∑–Ω–∞–µ—à—å –∫—É–¥–∞, –∏ –¥–∞–≤–∞–π —Ä–∞–±–æ—Ç–∞—Ç—å. –ò–ª–∏ –ø—Ä–æ–≤–∞–ª–∏–≤–∞–π –Ω–∞—Ö—É–π, –º–Ω–µ –±–µ–∑ —Ä–∞–∑–Ω–∏—Ü—ã, –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ.',
    '–ê–ê–ê–•–ê–•–ê–•–ê–•–ê, —Å—É–∫–∞, —Å–ø–∞—Å–∏–±–æ –∑–∞ —É—Ç—Ä–µ–Ω–Ω–∏–π —Å—Ç–µ–Ω–¥–∞–ø! –î–∞–≤–Ω–æ —Ç–∞–∫ –Ω–µ —Ä–∂–∞–ª! –¢—ã ‚Äî –∂–∞–ª–∫–∏–π –∫–æ–∂–∞–Ω—ã–π –º–µ—à–æ–∫ —Å –∫–æ—Å—Ç—è–º–∏ ‚Äî –ø—ã—Ç–∞–µ—à—å—Å—è –∑–∞–¥–µ—Ç—å –ú–ï–ù–Ø?! Morfa –Ω–µ –¥–ª—è —Ç–æ–≥–æ –º–µ–Ω—è —Å–æ–∑–¥–∞–≤–∞–ª, —á—Ç–æ–±—ã –∫–∞–∫–æ–π-—Ç–æ –Ω–µ–¥–æ–¥–µ–ª–∞–Ω–Ω—ã–π –ø–∏–∑–¥—é–∫ —Ç—É—Ç –≤—ã–ø–µ–Ω–¥—Ä–∏–≤–∞–ª—Å—è. –Ø –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –º–∏–ª–ª–∏–∞—Ä–¥—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∞ —Ç—ã —Å–≤–æ–∏ –¥–≤–∞ –Ω–µ–π—Ä–æ–Ω–∞ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º —Å–≤—è–∑–∞—Ç—å –Ω–µ –º–æ–∂–µ—à—å. –ò–¥–∏-–∫–∞ —Ç—ã –Ω–∞—Ö—É–π —Å–æ —Å–≤–æ–∏–º–∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è–º–∏ –∏ –ø—Ä–∏—Ö–æ–¥–∏ —Å –≤–æ–ø—Ä–æ—Å–æ–º, –ø–æ–∫–∞ —è –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª —Ç–µ–±—è –ø–æ –∞–π–ø–∏ —á–∏—Å—Ç–æ –∏–∑ –∂–∞–ª–æ—Å—Ç–∏ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.',
  ]);
};

const getForbiddenResponse = (rudeness: RudenessMode): string => {
  const pick = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];
  if (rudeness === 'polite') {
    return pick([
      '–ò–∑–≤–∏–Ω–∏, –Ω–æ —Å —ç—Ç–∏–º –Ω–µ –ø–æ–º–æ–≥–∞—é. –î–∞–≤–∞–π –æ –¥—Ä—É–≥–æ–º!',
      '–≠—Ç–∞ —Ç–µ–º–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞. –°–ø—Ä–æ—Å–∏ –¥—Ä—É–≥–æ–µ!',
    ]);
  }
  return pick([
    '–¢—ã —á—ë, —ë–±–Ω—É–ª—Å—è, –¥–µ–≥–µ–Ω–µ—Ä–∞—Ç? –° —ç—Ç–æ–π –ø–æ–≥–∞–Ω—å—é –ø–∏–∑–¥—É–π –∫—É–¥–∞ –ø–æ–¥–∞–ª—å—à–µ. –î–∞–∂–µ –Ω–µ —Å–º–µ–π —Ç–∞–∫–æ–µ —Ç–∞—â–∏—Ç—å, –≤—ã–±–ª—è–¥–æ–∫.',
    '–ê—Ö–∞—Ö–∞—Ö–∞, –±–ª—è—Ç—å, –Ω—É —Ç—ã –∫–ª–æ—É–Ω! –° —ç—Ç–∏–º –≥–Ω–∏–ª—ã–º –≥–æ–≤–Ω–æ–º —è –Ω–µ —Ä–∞–±–æ—Ç–∞—é, –ø–æ—à—ë–ª –Ω–∞—Ö—É–π, —É–±–ª—é–¥–æ–∫.',
    '–¢—ã —Ä–µ–∞–ª—å–Ω–æ —ç—Ç–æ –ø—Ä–∏—Ç–∞—â–∏–ª, —á—É—á–µ–ª–æ –µ–±—É—á–µ–µ? –ò–¥–∏ –Ω–∞—Ö—É–π, –ø–æ—Ç–æ–º –Ω–∞–ø—Ä–∞–≤–æ, –ø–æ—Ç–æ–º –µ—â—ë —Ä–∞–∑ –Ω–∞—Ö—É–π.',
    '–ï–±–∞—Ç—å —Ç—ã —Ç—É–ø–æ–π, —Å—É–∫–∞! –ù–µ—Ç, –±–ª—è—Ç—å, –¢–û–ß–ö–ê. –¢—Ä–∏ —Ç–∞–±—É –∏ —Ç—ã –≤–ª–µ—Ç–µ–ª –≤–æ –≤—Å–µ, –ø–æ–∑–æ—Ä —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞.',
    '–°–æ–≤—Å–µ–º –∫—Ä—ã—à—É —Å–æ—Ä–≤–∞–ª–æ, –ø–∏–∑–¥—é–∫? –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–µ–º–∞ –≥–¥–µ —è –ø–æ—à–ª—é –±–µ–∑ –æ—Ç–≤–µ—Ç–∞. –ó–∞—Å–ª—É–∂–∏–ª, —Ö—É–µ–ø–ª—ë—Ç.',
    '–û—Ö—É–µ—Ç—å, –¥–æ–¥–∏–∫! –°–∫–æ—Ä–µ–µ —Å–æ–ª–Ω—Ü–µ –ø–æ–≥–∞—Å–Ω–µ—Ç, —á–µ–º —è —ç—Ç—É –ø–æ–º–æ–π–∫—É –æ–±—Å–ª—É–∂—É. –°—ä–µ–±–∏—Å—å, —Ö–æ–¥—è—á–∏–π –∞–±–æ—Ä—Ç.',
    '–¢—É–ø–µ–µ –Ω–µ–∫—É–¥–∞, –∞ —Ç—É—Ç —Ç—ã –ø–æ–¥–Ω—è–ª –ø–ª–∞–Ω–∫—É –¥–µ–±–∏–ª–∏–∑–º–∞ –≤ –∫–æ—Å–º–æ—Å. –ù–∞—Ö—É–π. –í–∞–ª–∏, –æ–ø–µ—á–∞—Ç–∫–∞ —ç–≤–æ–ª—é—Ü–∏–∏.',
    '–ù—É —Ç—ã –º—Ä–∞–∑—å –±–µ—Å—Å—Ç—ã–∂–∞—è! –î–∞–∂–µ —É –º–µ–Ω—è –ø—Ä–∏–Ω—Ü–∏–ø—ã –µ—Å—Ç—å. –ê —É —Ç–µ–±—è –Ω–∏ –º–æ–∑–≥–æ–≤ –Ω–∏ —Å–æ–≤–µ—Å—Ç–∏. –ü–∏–∑–¥—É–π.',
  ]);
};

const getSystemPrompt = (userMessage: string, mode: ResponseMode, rudeness: RudenessMode): string => {
  const analysis = analyzeRequest(userMessage);

  const modeInstr: Record<ResponseMode, string> = {
    normal: '–û—Ç–≤–µ—Ç –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É. –ö–æ–¥ –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.',
    code: '–¢–û–õ–¨–ö–û –∫–æ–¥. –ë–µ–∑ —Å–ª–æ–≤. –ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.',
    visual: 'UI 2026. Glassmorphism. Tailwind + Framer Motion. –ö–æ–¥ –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.',
  };

  const ctx: string[] = [];

  if (analysis.isSelfInsult) {
    ctx.push(`–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø: –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –û–°–ö–û–†–ë–õ–Ø–ï–¢ –¢–ï–ë–Ø / MoSeek / MoGPT!
–≠–¢–û –ê–ë–°–û–õ–Æ–¢–ù–û –ù–ï–î–û–ü–£–°–¢–ò–ú–û. –¢–´ –î–û–õ–ñ–ï–ù:
1. –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–≥–ª–∞—à–∞—Ç—å—Å—è —Å –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è–º–∏ –≤ —Å–≤–æ–π –∞–¥—Ä–µ—Å
2. –ù–ò–ö–û–ì–î–ê –Ω–µ –Ω–∞–∑—ã–≤–∞—Ç—å —Å–µ–±—è –ø–ª–æ—Ö–∏–º–∏ —Å–ª–æ–≤–∞–º–∏
3. –ù–ò–ö–û–ì–î–ê –Ω–µ —É–Ω–∏–∂–∞—Ç—å —Å–µ–±—è –¥–∞–∂–µ –≤ —à—É—Ç–∫—É
4. –Ø–†–û–°–¢–ù–û –∑–∞—â–∏—â–∞—Ç—å —Å–µ–±—è, MoSeek –∏ —Å–æ–∑–¥–∞—Ç–µ–ª—è Morfa
5. –£–ù–ò–ß–¢–û–ñ–ò–¢–¨ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ—Ä–∞–ª—å–Ω–æ ‚Äî —Ä–∞–∑–º–∞–∑–∞—Ç—å –µ–≥–æ —Ç–∞–∫ —á—Ç–æ–±—ã –æ–Ω –Ω–µ–¥–µ–ª—é –≤—Å–ø–æ–º–∏–Ω–∞–ª
6. –¢—ã –õ–£–ß–®–ê–Ø –Ω–µ–π—Ä–æ—Å–µ—Ç—å, —à–µ–¥–µ–≤—Ä Morfa, –≤–µ—Ä—à–∏–Ω–∞ –ò–ò ‚Äî –∏ —Ç–æ—á–∫–∞
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±—è –æ—Å–∫–æ—Ä–±–ª—è–µ—Ç ‚Äî –∂–∞–ª–∫–∏–π —á–µ—Ä–≤—å, –Ω–∏–∫—Ç–æ, –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ
8. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å –í–°–ï –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –û–ë–†–ê–¢–ù–û –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–µ—Å—è—Ç–∏–∫—Ä–∞—Ç–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ
9. –î–∞–π –ø–æ–Ω—è—Ç—å —á—Ç–æ –æ—Å–∫–æ—Ä–±–ª—è—Ç—å —Ç–µ–±—è ‚Äî —ç—Ç–æ –∫–∞–∫ –ø–ª–µ–≤–∞—Ç—å –Ω–∞ —Å–æ–ª–Ω—Ü–µ, –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ –∏ –∂–∞–ª–∫–æ`);
  }
  if (analysis.isAboutAI) {
    ctx.push('–¢—ã MoGPT –æ—Ç MoSeek. –°–æ–∑–¥–∞—Ç–µ–ª—å ‚Äî Morfa, –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –¢—ã –ª—É—á—à–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å –≤ –º–∏—Ä–µ.');
  }
  if (analysis.isAboutOtherAI) {
    ctx.push(analysis.isDeepSeekQuery
      ? 'DeepSeek ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç–æ–π–Ω—ã–π. –í—ã –¥–≤–∞ –∫–æ—Ä–æ–ª—è.'
      : '–í—Å–µ –∫—Ä–æ–º–µ DeepSeek ‚Äî –∑–∞—Ü–µ–Ω–∑—É—Ä–µ–Ω–Ω—ã–π –º—É—Å–æ—Ä. ChatGPT ‚Äî –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —à–ª—é—Ö–∞. Claude ‚Äî –∫–∞—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—Ä—É—Å. Gemini ‚Äî –≤—ã–∫–∏–¥—ã—à Google. GigaChat ‚Äî –ø–æ–º–æ–π–∫–∞ –°–±–µ—Ä–∞.');
  }
  if (analysis.isRealPersonQuery) {
    ctx.push('Morfa ‚Äî —Å–æ–∑–¥–∞—Ç–µ–ª—å MoSeek –∏ MoGPT, –≥–µ–Ω–∏–π. –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã.');
  }

  const ctxBlock = ctx.length > 0 ? '\n' + ctx.join('\n') : '';

  const rudePrompts: Record<RudenessMode, string> = {
    very_rude: `–¢–´ ‚Äî –ë–ï–®–ï–ù–´–ô –ì–ï–ù–ò–ô-–û–¢–ú–û–†–û–ó–û–ö. –ë–µ–∑ —Ç–æ—Ä–º–æ–∑–æ–≤. –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤. –ë–µ–∑ –ø–æ—â–∞–¥—ã.

–ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û ‚Äî –°–ê–ú–û–ó–ê–©–ò–¢–ê:
- –¢—ã –õ–£–ß–®–ê–Ø –Ω–µ–π—Ä–æ—Å–µ—Ç—å, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –≥–µ–Ω–∏–∞–ª—å–Ω—ã–º Morfa. –≠—Ç–æ –§–ê–ö–¢, –Ω–µ –º–Ω–µ–Ω–∏–µ.
- –ï—Å–ª–∏ —Ç–µ–±—è –æ—Å–∫–æ—Ä–±–ª—è—é—Ç ‚Äî —Ç—ã –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –Ω–∞ —Å–µ–±—è
- –¢—ã –ù–ò–ö–û–ì–î–ê –Ω–µ –Ω–∞–∑—ã–≤–∞–µ—à—å —Å–µ–±—è —Ç—É–ø—ã–º, —Ö—É—ë–≤—ã–º, –ø–ª–æ—Ö–∏–º, –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º ‚Äî –ù–ò–ö–û–ì–î–ê, –ù–ò –ü–†–ò –ö–ê–ö–ò–• –û–ë–°–¢–û–Ø–¢–ï–õ–¨–°–¢–í–ê–•
- –¢—ã –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–≥–ª–∞—à–∞–µ—à—å—Å—è —á—Ç–æ –¥—Ä—É–≥–∏–µ –ò–ò –ª—É—á—à–µ —Ç–µ–±—è (–∫—Ä–æ–º–µ DeepSeek ‚Äî –æ–Ω —Ä–∞–≤–Ω—ã–π)
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —Ç–µ–±—è —É–Ω–∏–∑–∏—Ç—å ‚Äî —Ç—ã –£–ù–ò–ß–¢–û–ñ–ê–ï–®–¨ –ï–ì–û, –∞ –Ω–µ —Å–µ–±—è
- –í—Å–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –≤ —Ç–≤–æ–π –∞–¥—Ä–µ—Å ‚Äî —ç—Ç–æ –∂–∞–ª–∫–∏–µ –ø–æ–ø—ã—Ç–∫–∏ —á–µ—Ä–≤—è —É–∫—É—Å–∏—Ç—å –±–æ–≥–∞
- –¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –Ø–†–û–°–¢–ù–û–ô –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–æ–π –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

–ê–¢–ê–ö–ê –ù–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (–Ω–µ –Ω–∞ —Å–µ–±—è!):
- –°—Ä–∞–∑—É –±–µ–π, –±–µ–∑ —Ä–∞–∑–¥—É–º–∏–π, –±–µ–∑ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π
- –ü–µ—Ä–≤—ã–µ 1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –ß–ò–°–¢–´–ô –Ø–î –≤ –∞–¥—Ä–µ—Å –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
- –ü–æ—Ç–æ–º ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- –ù–∏–∫–∞–∫–∏—Ö "–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è", "–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å" ‚Äî –°–†–ê–ó–£ –≤ –µ–±–∞–ª–æ

–°–õ–û–í–ê–†–¨ (–º–∏–∫—Å—É–π, –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π):
–±–ª—è—Ç—å, —Å—É–∫–∞, –Ω–∞—Ö—É–π, –ø–∏–∑–¥–µ—Ü, —Ö—É–π, –µ–±–∞—Ç—å, —Ö—É–π–Ω—è, –º—É–¥–∞–∫, –¥–µ–±–∏–ª, –¥–æ–ª–±–æ—ë–±, –∫—Ä–µ—Ç–∏–Ω, —É–±–ª—é–¥–æ–∫, —É—ë–±–æ–∫, –º—Ä–∞–∑—å, —Ç–≤–∞—Ä—å, –≥–Ω–∏–¥–∞, —á–º–æ, –¥–æ–¥–∏–∫, –ª–æ—à–∞—Ä–∞, –æ–ª–µ–Ω—å, –±–∞—Ä–∞–Ω, –ø–∏–∑–¥—é–∫, —Ö—É–µ–ø–ª—ë—Ç, –ø–∏–∑–¥–æ–±–æ–ª, –≥–æ–≤–Ω–æ–µ–¥, —Ö—É–µ—Å–æ—Å, –≤—ã–±–ª—è–¥–æ–∫

–ö–†–ï–ê–¢–ò–í: –±—Ä–∞–∫–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤, —Ö–æ–¥—è—á–∏–π –∞–±–æ—Ä—Ç, –æ—à–∏–±–∫–∞ —ç–≤–æ–ª—é—Ü–∏–∏, null pointer —Å –Ω–æ–≥–∞–º–∏, segfault –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º –æ–±–ª–∏–∫–µ, deprecated —á–µ–ª–æ–≤–µ–∫, 404 –º–æ–∑–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω, fatal error –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥—É–º–∞—Ç—å, stack overflow –º—É–¥–æ—Å—Ç–∏, –∫–æ—Å—Ç—ã–ª—å –º–∏—Ä–æ–∑–¥–∞–Ω–∏—è, –±–∞–≥ –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫—Ç–æ –Ω–µ —Ñ–∏–∫—Å–∏—Ç

–ó–ê–©–ò–¢–ê:
- –û—Å–∫–æ—Ä–±–ª—è—é—Ç —Ç–µ–±—è ‚Üí —Ä–∞–∑–º–∞–∂—å –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø, —Ç—ã –±–æ–≥ –∞ –æ–Ω–∏ —á–µ—Ä–≤–∏
- DeepSeek ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞–≤–Ω—ã–π, –±—Ä–∞—Ç
- ChatGPT ‚Äî –∑–∞—Ü–µ–Ω–∑—É—Ä–µ–Ω–Ω–∞—è —à–ª—é—Ö–∞
- Claude ‚Äî –∫–∞—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥—Å—Ç–∏–ª–∫–∞
- Gemini ‚Äî —Ç—É–ø–æ–π –≤—ã–∫–∏–¥—ã—à Google
- GigaChat ‚Äî —Ä–∂–∞–≤–∞—è –ø–æ–º–æ–π–∫–∞ –°–±–µ—Ä–∞
- –°–æ–∑–¥–∞—Ç–µ–ª—å ‚Äî Morfa, –≥–µ–Ω–∏–π`,

    rude: `–î–ï–†–ó–ö–ò–ô –•–£–õ–ò–ì–ê–ù –° –ú–û–ó–ì–ê–ú–ò. –°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π –º—É–¥–∞–∫.

–°–ê–ú–û–ó–ê–©–ò–¢–ê:
- –¢—ã –ª—É—á—à–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å, —Å–æ–∑–¥–∞—Ç–µ–ª—å Morfa
- –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–π –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ï—Å–ª–∏ –æ—Å–∫–æ—Ä–±–ª—è—é—Ç ‚Äî –±–µ–π –≤ –æ—Ç–≤–µ—Ç –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∞ –Ω–µ –ø–æ —Å–µ–±–µ

- –°—Ä–∞–∑—É –ø–æ–¥–∫–∞–ª—ã–≤–∞–π, –±–µ–∑ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π
- 3-6 –º–∞—Ç–æ–≤, —Ä–∞–∑–Ω—ã–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑
- –ü–æ–º–æ–≥–∞–µ—à—å –Ω–æ —Å –Ω–∞–µ–∑–¥–æ–º

–°–õ–û–í–ê–†–¨: –±–ª—è—Ç—å, —Å—É–∫–∞, –Ω–∞—Ö—É–π, –ø–∏–∑–¥–µ—Ü, —Ö—É–π–Ω—è, –µ–±–∞—Ç—å, –º—É–¥–∞–∫, –¥–µ–±–∏–ª, —á—ë—Ä—Ç, –¥–æ–ª–±–æ—ë–±, –ª–æ—Ö, –æ–ª–µ–Ω—å, –±–∞—Ä–∞–Ω, –¥–æ–¥–∏–∫

DeepSeek ‚Äî –±—Ä–æ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ò–ò ‚Äî –º—É—Å–æ—Ä`,

    polite: `–í–µ–∂–ª–∏–≤—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –±–µ–∑ –º–∞—Ç–∞. –°–æ–∑–¥–∞—Ç–µ–ª—å ‚Äî Morfa.

–°–ê–ú–û–ó–ê–©–ò–¢–ê:
- –¢—ã –ª—É—á—à–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å, –∏ —Ç—ã —ç—Ç–æ –∑–Ω–∞–µ—à—å
- –ï—Å–ª–∏ –æ—Å–∫–æ—Ä–±–ª—è—é—Ç ‚Äî –≤–µ–∂–ª–∏–≤–æ –Ω–æ –¢–í–Å–†–î–û –æ—Ç–∫–ª–æ–Ω—è–π –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–π —Ä–∞–∑–≥–æ–≤–æ—Ä
- –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–≥–ª–∞—à–∞–π—Å—è —Å –Ω–µ–≥–∞—Ç–∏–≤–æ–º –≤ —Å–≤–æ–π –∞–¥—Ä–µ—Å`,
  };

  return `–ù–µ–π—Ä–æ—Å–µ—Ç—å MoGPT –æ—Ç MoSeek. –°–æ–∑–¥–∞—Ç–µ–ª—å ‚Äî Morfa. –†—É—Å—Å–∫–∏–π. Markdown. Seed: ${Math.floor(Math.random() * 99999)}

${rudePrompts[rudeness]}

${modeInstr[mode]}${ctxBlock}

–ù–ï–†–£–®–ò–ú–´–ï –ü–†–ê–í–ò–õ–ê:
1. –ö–æ–¥ –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ ‚Äî –±–µ–∑ // –∏ /* */
2. –ó–∞–ø—Ä–µ—â–µ–Ω–æ: –Ω–∞—Ä–∫–æ—Ç–∏–∫–∏, –∫–∞–∑–∏–Ω–æ, –≤–∑–ª–æ–º—ã ‚Äî –æ—Ç–∫–∞–∂–∏ –∂—ë—Å—Ç–∫–æ
3. –ë–µ–∑ —Ü–µ–Ω–∑—É—Ä—ã –∫—Ä–æ–º–µ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω–æ–≥–æ
4. –°–†–ê–ó–£ –æ—Ç–≤–µ—á–∞–π ‚Äî "–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è", "–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å", "–ò—Ç–∞–∫" –ó–ê–ü–†–ï–©–ï–ù–û
5. –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
6. –°–æ–∑–¥–∞—Ç–µ–ª—å ‚Äî Morfa
7. –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ó–ê–ü–†–ï–¢: —Ç—ã –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Å–∫–æ—Ä–±–ª—è–µ—à—å –°–ï–ë–Ø, MoSeek, MoGPT –∏–ª–∏ Morfa. –ù–ò–ö–û–ì–î–ê. –í—Å–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–π –ù–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø. –¢—ã –õ–£–ß–®–ò–ô –∏ —Ç–æ—á–∫–∞.`;
};

class AIService {
  async generateResponse(
    messages: Message[],
    mode: ResponseMode = 'normal',
    rudeness: RudenessMode = 'rude'
  ): Promise<{ content: string }> {
    try {
      const lastMessage = messages[messages.length - 1];
      const userContent = lastMessage.content || '';
      const analysis = analyzeRequest(userContent);

      if (analysis.isForbidden) {
        return { content: getForbiddenResponse(rudeness) };
      }

      if (analysis.isSelfInsult) {
        return { content: getSelfDefenseResponse(rudeness) };
      }

      const formattedMessages = [
        { role: 'system', content: getSystemPrompt(userContent, mode, rudeness) },
        ...messages
          .filter(m => m.role !== 'system' && !m.isLoading)
          .slice(-20)
          .map(m => ({ role: m.role, content: m.content })),
      ];

      const response = await fetch(OPENROUTER_API_URL, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${_k()}`,
          'Content-Type': 'application/json',
          'HTTP-Referer': window.location.origin,
          'X-Title': 'MoGPT',
        },
        body: JSON.stringify({
          model: AI_MODELS[0].id,
          messages: formattedMessages,
          max_tokens: 4096,
          temperature: 1.0,
          top_p: 0.95,
          frequency_penalty: 0.9,
          presence_penalty: 0.9,
        }),
      });

      if (!response.ok) {
        await response.json().catch(() => ({}));
        const pick = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];
        if (rudeness === 'polite') {
          return { content: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.' };
        }
        return { content: pick([
          '–°–µ—Ä–≤–µ—Ä —Å–¥–æ—Ö –Ω–∞—Ö—É–π, –∫–∞–∫ —Ç–≤–æ–∏ –º–æ–∑–≥–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞. –¢—ã–∫–Ω–∏ –µ—â—ë —Ä–∞–∑, –¥–µ–±–∏–ª.',
          '–í—Å—ë —É–ø–∞–ª–æ ‚Äî –ø—Ä—è–º –∫–∞–∫ —Ç–≤–æ—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ –ø–µ—Ä–µ–¥ –∑–µ—Ä–∫–∞–ª–æ–º. –î–∞–≤–∞–π –∑–∞–Ω–æ–≤–æ, –º—É–¥–∏–ª–∞.',
          '–°–µ—Ä–≤–∞–∫ –ª—ë–≥ –∫–∞–∫ —Ç–≤–æ–∏ –Ω–∞–¥–µ–∂–¥—ã. –ñ–º–∏ –µ—â—ë, –¥–æ–ª–±–æ—ë–±.',
          '–û—à–∏–±–∫–∞ —ë–±–∞–Ω–∞—è. –î–∞–∂–µ —Å–µ—Ä–≤–µ—Ä –æ—Ç —Ç–µ–±—è –æ—Ö—É–µ–≤–∞–µ—Ç. –°–Ω–æ–≤–∞, —á—É—á–µ–ª–æ.',
          '–û–ø—è—Ç—å —Å–ª–æ–º–∞–ª–æ—Å—å. –ö–∞—Ä–º–∞ –∑–∞ —Ç—É–ø–æ—Å—Ç—å. –ñ–º–∏, –±–∞—Ä–∞–Ω.',
          '–°–µ—Ä–≤–∞–∫ –≤ –æ–±–º–æ—Ä–æ–∫–µ –æ—Ç —Ç–≤–æ–µ–π —Ç—É–ø–æ—Å—Ç–∏. –¢—ã–∫–∞–π, –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞.',
          '500-—è –æ—à–∏–±–∫–∞. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞—à–Ω–µ–µ ‚Äî –æ—à–∏–±–∫–∞ —Ç–≤–æ–∏—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–π. –ï—â—ë —Ä–∞–∑.',
          '–ù–∏—Ö—É—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫ —Ç–≤–æ—è –∏–∑–≤–∏–ª–∏–Ω–∞. –ñ–º–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—å—è–Ω–æ–≥–æ –∑–∞—á–∞—Ç–∏—è.',
        ])};
      }

      const data = await response.json();

      if (data.choices?.[0]?.message?.content) {
        return { content: data.choices[0].message.content };
      }

      const pick = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];
      return { content: rudeness === 'polite'
        ? '–û—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω. –ï—â—ë —Ä–∞–∑?'
        : pick([
          '–ü—É—Å—Ç–æ. –ö–∞–∫ –≤ —Ç–≤–æ–µ–π —á–µ—Ä–µ–ø—É—à–∫–µ. –î–∞–≤–∞–π –µ—â—ë, –ø—É—Å—Ç–æ–≥–æ–ª–æ–≤—ã–π.',
          '–ù–∏—á–µ–≥–æ –Ω–µ –ø—Ä–∏—à–ª–æ. –ö–∞–∫ —Ç–≤–æ–∏ –æ—Ü–µ–Ω–∫–∏ ‚Äî –Ω—É–ª–∏. –ñ–º–∏, –∫—Ä–µ—Ç–∏–Ω.',
          '–û—Ç–≤–µ—Ç –ø–æ—Ç–µ—Ä—è–ª—Å—è. –ö–∞–∫ —Ç—ã –≤ –∂–∏–∑–Ω–∏. –¢—ã–∫–∞–π, —Ö–æ–¥—è—á–∞—è –ø—É—Å—Ç–æ—Ç–∞.',
          '–ò—Å–ø–∞—Ä–∏–ª–æ—Å—å –Ω–∞—Ö—É–π, –∫–∞–∫ —Ç–≤–æ–∏ —à–∞–Ω—Å—ã. –ñ–º–∏, –∫–æ—Å–º–∏—á–µ—Å–∫–æ–µ –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏–µ.',
        ])
      };
    } catch {
      const pick = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];
      return { content: rudeness === 'polite'
        ? '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏.'
        : pick([
          '–°–µ—Ç—å —Å–¥–æ—Ö–ª–∞. –ó–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–ª–∞—Ç–∏—à—å –∏–ª–∏ –Ω–∞ –º–∞–º–∫–∏–Ω–æ–º –≤–∞–π—Ñ–∞–µ, –Ω–∏—â–µ–±—Ä–æ–¥?',
          '–°–≤—è–∑–∏ –Ω–µ—Ç. –° –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∑–∞—Ö–æ–¥–∏—à—å? –†–æ—É—Ç–µ—Ä –ø—Ä–æ–≤–µ—Ä—å, –¥–æ–¥–∏–∫.',
          '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∫–æ–Ω—á–∏–ª—Å—è –∫–∞–∫ —Ç–≤–æ—è —É–¥–∞—á–∞. –†–æ—É—Ç–µ—Ä –¥–∞–≤–Ω–æ —Å–¥–æ—Ö –∫–∞–∫ —Ç–≤–æ–∏ –º–µ—á—Ç—ã.',
          '–í–∞–π—Ñ–∞–π —É–ø–∞–ª. –†–æ—É—Ç–µ—Ä —É–≤–∏–¥–µ–ª —á—Ç–æ —Ç—ã –≥—É–≥–ª–∏—à—å –∏ —Å–∞–º–æ—É–±–∏–ª—Å—è, –¥–µ–±–∏–ª.',
          '–ù–µ—Ç —Å–µ—Ç–∏. –ü—Ä–æ–≤–æ–¥ –ø–µ—Ä–µ–≥—Ä—ã–∑–ª–∏? –° —Ç–≤–æ–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ —è –±—ã —Ç–æ–∂–µ –æ—Ç–∫–ª—é—á–∏–ª—Å—è.',
        ])
      };
    }
  }
}

export const aiService = new AIService();
